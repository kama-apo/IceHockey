<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Javascript IceHockey</title>
    <style>
        body{
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: white;

        }
        canvas {

            border: 6px solid black;
        }

        table {
            width: 100%;
            justify-content: center;
            font-size: 20px;
        }
    </style>
</head>
<body>
<div>

    <div id="board" style="visibility: visible">
        <table>
            <tr>
                <th>Player 1</th>
                <th>Player 2</th>
            </tr>
            <tr id="score">
            </tr>
        </table>

        <canvas></canvas>
    </div>

    <div id="gameover" style="visibility: hidden; text-align: center">
        <h1 id="closure"></h1>
        <button onclick="reset()">Play Again!</button>
    </div>

</div>

<script>

    const canvas = document.querySelector('canvas');

    const ctx = canvas.getContext('2d');
    const ballSize = 20;


    canvas.width=1000;
    canvas.height=500;

    const cw = canvas.width;
    const ch = canvas.height;

    const paddleHeight = 100;
    const paddelWidth = 20;

    const playerX= 70;
    const aiX =910;

    const lineWidht=3;
    const lineHeight=13;
    const scoreToWin = 10;

    let ballX;
    let ballY;

    let playerY;
    let aiY;

    let scorePlayer;
    let scoreAI;

    let ballSpeedX;
    let ballSpeedY;

    function init(){
        ballX = cw/2-ballSize/2;
        ballY = ch/2-ballSize/2;

        playerY=200;
        aiY=200;

        scorePlayer=0;
        scoreAI=0;

        ballSpeedX = -3;
        ballSpeedY = 3;
    }

    function reset() {
        document.getElementById("gameover").style.visibility = "hidden";
        document.getElementById("board").style.visibility = "visible";

        init();

    }
    function player() {
        ctx.fillStyle='yellowgreen';
        ctx.fillRect(playerX,playerY,paddelWidth,paddleHeight);

    }
    function ai() {
        ctx.fillStyle='yellow';
        ctx.fillRect(aiX,aiY,paddelWidth,paddleHeight);

    }

   function ball() {

       ctx.fillStyle= "white";
       ctx.fillRect(ballX, ballY, ballSize, ballSize);

       ballX += ballSpeedX;
       ballY += ballSpeedY;

       if (ballY <= 0 || ballY + ballSize >= ch) {
           ballSpeedY = -ballSpeedY;
       }

       //odbicie od lewej krawedzi
       if (ballSpeedX < 0 && ballX <= 0 + lineWidht) {
           ballSpeedX = -ballSpeedX;
           speedUp();
           scoreAI++;
       }

       //odbicie od prawej krawedzi
       if (ballSpeedX >0 && ballX + ballSize >= cw - lineWidht) {
           ballSpeedX = -ballSpeedX;
           speedUp();
           scorePlayer++;
       }

       //odbij pilke od paletki zawodnika - od srodka
       if (ballSpeedX < 0 && ballX <= playerX + paddelWidth && ballX >= playerX && ballY + ballSize >= playerY && ballY <= playerY + paddleHeight) {
           ballSpeedX = -ballSpeedX;
       }

       //odbij pilke od paletki zawodnika - od zewnatrz
//       if (ballSpeedX > 0 && ballX + ballSize >= playerX && ballX + ballSize <= playerX + paddelWidth && ballY + ballSize >= playerY && ballY <= playerY + paddleHeight) {
//           ballSpeedX = -ballSpeedX;
//       }

       //odbij pilke od paletki KOMPUTERA - od srodka
       if (ballSpeedX > 0 && ballX + ballSize >= aiX && ballX <= aiX + paddelWidth && ballY + ballSize >= aiY && ballY <= aiY + paddleHeight) {
           ballSpeedX = -ballSpeedX;
       }
       //odbij pilke od paletki KOMPUTERA - od zewnatrz
//       if (ballSpeedX < 0 && ballX <= aiX + paddelWidth && ballX >= aiX && ballY + ballSize >= aiY && ballY <= aiY + paddleHeight) {
//           ballSpeedX = -ballSpeedX;
//       }

   }

    function  speedUp() {
        console.log ("speedUp");
        if ( ballSpeedX > 0 && ballSpeedX <20) {
            ballSpeedX +=3;
        }else if ( ballSpeedX < 0 && ballSpeedX > -20){
            ballSpeedX -+3;
        }

    }

   function uodateScoreboard(){

       document.getElementById("score").innerHTML = "<th>"+scorePlayer+"</th><th>"+scoreAI+"</th>";
       if (scorePlayer >= scoreToWin) {
           document.getElementById("board").style.visibility = "hidden";
           document.getElementById("gameover").style.visibility = "visible";
           document.getElementById("closure").innerHTML = "Player 1 Wins!";

       }
       if (scoreAI >= scoreToWin) {
           document.getElementById("board").style.visibility = "hidden";
           document.getElementById("gameover").style.visibility = "visible";
           document.getElementById("closure").innerHTML = "Player 2 Wins!";
       }
   }

   function table () {
       ctx.fillStyle = 'lightblue';
       ctx.fillRect(0, 0, cw, ch);


        for ( let linePosition = 0; linePosition < ch; linePosition += 20) {
        ctx.fillStyle='red';
        ctx.fillRect(cw/2-3, linePosition,lineWidht,lineHeight);}

       ctx.fillStyle= 'red';
       ctx.fillRect(67,0,lineWidht,ch);
       ctx.fillStyle= 'red';
       ctx.fillRect(930,0,lineWidht,ch);
       ctx.fillStyle= "blue";
       ctx.fillRect(320,0,lineWidht,ch);
       ctx.fillStyle= "blue";
       ctx.fillRect(674,0,lineWidht,ch);

       ctx.beginPath()
       ctx.strokeStyle = "blue";
       ctx.arc(500,250,100,0,2* Math.PI);
       ctx.lineWidth =3;
       ctx.stroke();
   }




    topCanvas = canvas.offsetTop;
    console.log(topCanvas);

    function playerPosition (e){
        //console.log('pozycja myszy'+(e.clientY - topCanvas));
        playerY = e.clientY - topCanvas - paddleHeight/2;

        if (playerY >= ch - paddleHeight){
            playerY = ch - paddleHeight
        }

        if( playerY <= 0){
            playerY= 0;
        }
    }
        canvas.addEventListener('mousemove', playerPosition);

    function aiPosition() {
        const middlePaddel = aiY + paddleHeight/2;
        const middleBall = ballY + ballSize/2 ;
        if (ballX > 500 && Math.random() > 0.6) {
            if (middlePaddel - middleBall >200){
                aiY -=20;

            } if (middlePaddel - middleBall >50){
                aiY -=10;

            } if (middlePaddel - middleBall < -200){
                aiY +=20;

            } if (middlePaddel - middleBall < -50){
                aiY +=10;

            }

        }
    }
   function game() {
       table();
       ball();
       player();
       ai();
       aiPosition();
       uodateScoreboard();
   }

    init();

    game();

    setInterval(game,1000/60)

</script>
</body>
</html>